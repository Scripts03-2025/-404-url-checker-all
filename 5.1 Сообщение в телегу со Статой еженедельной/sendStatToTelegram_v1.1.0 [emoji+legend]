// === üìä sendStatToTelegram_v1.1.0 [emoji+legend] ===
// –†–ê–ë–û–¢–ê–ï–¢ –ü–†–û–í–ï–†–ï–ù–û
// –í–µ—Ä—Å–∏–∏:
// v1.1.0 [emoji+legend] ‚Äî –°–º–∞–π–ª—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö, –∫–æ—Ä–æ—Ç–∫–∞—è –ª–µ–≥–µ–Ω–¥–∞
// v1.0.9 –∏ –Ω–∏–∂–µ ‚Äî —Å–º–æ—Ç—Ä–∏ –∏—Å—Ç–æ—Ä–∏—é

function sendWeeklyStatsToTelegram() {
  const TELEGRAM_TOKEN = '8136586676:AAHvXeM4ih9ECPdSwzGM5P0O1p2_GYb_iTk';
  const TELEGRAM_CHAT_ID = '8003377702';

  const sheet = SpreadsheetApp.getActive().getSheetByName("s5 –°—Ç–∞—Ç–∞");
  const weeks = sheet.getRange(7, 3, 1, 5).getValues()[0];

  const params = {
    "üî•": 10,
    "‚úçÔ∏è": 11,
    "üíª": 12,
    "–Ø": 15,
    "–Ø+2–Ω": 16,
    "G+–º": 17
  };

  const dataByParam = {};
  for (const [label, row] of Object.entries(params)) {
    dataByParam[label] = sheet.getRange(row, 3, 1, 5).getValues()[0].map(v =>
      (v === '' || v === '–Ω–µ—Ç –∏–Ω—Ñ—ã') ? 'x' : String(v)
    );
  }

  const fixWeek = (val) => String(val).substring(0, 9);
  const headers = Object.keys(params);

  let msg = '–ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç:\n\n';
  msg += '–ù–µ–¥–µ–ª—è | ' + headers.join(' | ') + '\n';

  for (let i = 0; i < 5; i++) {
    const week = fixWeek(weeks[i] || '');
    const row = headers.map(h => dataByParam[h][i]).join(' | ');
    msg += `${week} | ${row}\n`;
  }

  msg += `\nüìò –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:\nüî• ‚Äî –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ\n‚úçÔ∏è ‚Äî –Ω–∞–ø–∏—Å–∞–Ω–æ\nüíª ‚Äî –≤ —Ä–∞–±–æ—Ç—É`;

  msg = `<pre>${msg}</pre>üìé <a href="https://docs.google.com/spreadsheets/d/1n3InvbH_nTghhPWpNUA6T0hSafVSlgW2XVmuL88EW1g/edit?gid=1655944420#gid=1655944420&range=A7">–û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>`;

  const payload = {
    chat_id: TELEGRAM_CHAT_ID,
    text: msg,
    parse_mode: "HTML"
  };

  const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
  UrlFetchApp.fetch(url, {
    method: "post",
    contentType: "application/json",
    payload: JSON.stringify(payload)
  });
}
