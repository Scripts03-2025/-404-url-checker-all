// === üìä sendStatToTelegram_v1.1.0 [emoji+legend] ===
// –í–µ—Ç–∫–∞ ChatGPT: https://chatgpt.com/c/67e983c4-1050-8010-ad78-082a36dc7fc6

// –í–µ—Ä—Å–∏–∏:
// v1.1.0 [emoji+legend] ‚Äî –°–º–∞–π–ª—ã –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö, –∫—Ä–∞—Ç–∫–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ —Å–Ω–∏–∑—É
// v1.0.9 [tight-week] ‚Äî –°–∂–∞—Ç–∏–µ –∫–æ–ª–æ–Ω–∫–∏ "–ù–µ–¥–µ–ª—è"
// v1.0.8 [short-–Ø] ‚Äî "–Ø–Ω–¥" –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ "–Ø"
// v1.0.7 [x-for-missing] ‚Äî "–Ω/–¥" –∑–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ "x"
// v1.0.6 [clean-names] ‚Äî –ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç—á–µ—Ç–∞

function sendWeeklyStatsToTelegram() {
  const TELEGRAM_TOKEN = '8136586676:AAHvXeM4ih9ECPdSwzGM5P0O1p2_GYb_iTk';
  const TELEGRAM_CHAT_ID = '8003377702';

  const sheet = SpreadsheetApp.getActive().getSheetByName("s5 –°—Ç–∞—Ç–∞");
  const weeks = sheet.getRange(7, 3, 1, 5).getValues()[0];

  const params = {
    "üî•": 10,
    "‚úçÔ∏è": 11,
    "üíª": 12,
    "–Ø": 15,
    "–Ø+2–Ω": 16,
    "G+–º": 17
  };

  const dataByParam = {};
  for (const [label, row] of Object.entries(params)) {
    dataByParam[label] = sheet.getRange(row, 3, 1, 5).getValues()[0].map(v =>
      (v === '' || v === '–Ω–µ—Ç –∏–Ω—Ñ—ã') ? 'x' : String(v)
    );
  }

  const fixWeek = (val) => String(val).substring(0, 9);
  const headers = Object.keys(params);

  let msg = '–ù–µ–¥–µ–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç:\n\n';
  msg += '–ù–µ–¥–µ–ª—è | ' + headers.join(' | ') + '\n';

  for (let i = 0; i < 5; i++) {
    const week = fixWeek(weeks[i] || '');
    const row = headers.map(h => dataByParam[h][i]).join(' | ');
    msg += `${week} | ${row}\n`;
  }

  msg += `\nüìò –û–±–æ–∑–Ω–∞—á–µ–Ω–∏—è:\nüî• ‚Äî –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ\n‚úçÔ∏è ‚Äî –Ω–∞–ø–∏—Å–∞–Ω–æ\nüíª ‚Äî –≤ —Ä–∞–±–æ—Ç—É`;

  msg = `<pre>${msg}</pre>üìé <a href="https://docs.google.com/spreadsheets/d/1n3InvbH_nTghhPWpNUA6T0hSafVSlgW2XVmuL88EW1g/edit?gid=1655944420#gid=1655944420&range=A7">–û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É</a>`;

  const payload = {
    chat_id: TELEGRAM_CHAT_ID,
    text: msg,
    parse_mode: "HTML"
  };

  const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
  UrlFetchApp.fetch(url, {
    method: "post",
    contentType: "application/json",
    payload: JSON.stringify(payload)
  });
}

/*
üìò –°–ø—Ä–∞–≤–∫–∞ –ø–æ sendStatToTelegram_v1.1.0 [emoji+legend]

üîπ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
‚Äì –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ 6 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º –∏–∑ —Ç–∞–±–ª–∏—Ü—ã "s5 –°—Ç–∞—Ç–∞"
‚Äì –°—Ç–æ–ª–±—Ü—ã C:G = –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –Ω–µ–¥–µ–ª—å
‚Äì –ü–∞—Ä–∞–º–µ—Ç—Ä—ã: üî• (–æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ), ‚úçÔ∏è (–Ω–∞–ø–∏—Å–∞–Ω–æ), üíª (–≤ —Ä–∞–±–æ—Ç—É), –Ø, –Ø+2–Ω, G+–º
‚Äì –ó–∞–º–µ–Ω—è–µ—Ç –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞ "x"
‚Äì –°—Ç—Ä–æ–∏—Ç —Ç–∞–±–ª–∏—Ü—É —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ —Å–Ω–æ—Å–∫–æ–π
‚Äì –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Telegram —á–µ—Ä–µ–∑ Bot API
‚Äì –î–æ–±–∞–≤–ª—è–µ—Ç —Å—Å—ã–ª–∫—É –Ω–∞ Google –¢–∞–±–ª–∏—Ü—É

üîπ –ì–¥–µ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å:
‚Äì –°—Ç—Ä–æ–∫–∏ ‚Üí –æ–±—ä–µ–∫—Ç `params`
‚Äì –ö–æ–ª–æ–Ω–∫–∏ ‚Üí —Å—Ç—Ä–æ–∫–∞ 7 + —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
‚Äì –°–º–∞–π–ª—ã –∏ –ø–æ–¥–ø–∏—Å–∏ ‚Üí –≤ –±–ª–æ–∫–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
‚Äì –°—Å—ã–ª–∫–∞ ‚Üí –≤–Ω–∏–∑—É –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π

üîπ –í–µ—Ç–∫–∞ ChatGPT:
https://chatgpt.com/c/67e983c4-1050-8010-ad78-082a36dc7fc6
*/
