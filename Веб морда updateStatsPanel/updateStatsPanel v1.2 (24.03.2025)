/**
 * updateStatsPanel v1.2 (24.03.2025)
 * Ð ÐÐ‘ÐžÐ¢ÐÐ•Ð¢
 * ðŸ“Š Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ Ð¿Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ ÑÑÑ‹Ð»Ð¾Ðº
 * 
 * Ð§Ñ‚Ð¾ Ð´ÐµÐ»Ð°ÐµÑ‚:
 * - Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ Ð¾Ð±Ñ‰ÐµÐµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÐºÐ¾Ð´Ð¾Ð² (Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐµÐ½Ð½Ñ‹Ñ… Ñ‚ÐµÐºÑÑ‚Ð¾Ð²)
 * - ÐŸÐ¾Ð´ÑÑ‡Ð¸Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ ÑÐºÐ¾Ð»ÑŒÐºÐ¾ ÑÑ€ÐµÐ´Ð¸ Ð½Ð¸Ñ… 404, 403 Ð¸ 503
 * - ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð´Ð°Ñ‚Ñƒ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½ÐµÐ¹ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð¸Ð· ÐºÐ¾Ð»Ð¾Ð½ÐºÐ¸ E
 * - Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð²ÑÑ‘ ÑÑ‚Ð¾ Ð² ÑÑ‡ÐµÐ¹ÐºÐ¸ H1â€“H5 Ð½Ð° Ð»Ð¸ÑÑ‚Ðµ "404 (Ð½Ðµ Ð¼ÐµÐ½ÑÑ‚ÑŒ!)"
 * - Ð Ð°ÑÐºÑ€Ð°ÑˆÐ¸Ð²Ð°ÐµÑ‚ ÑÑ‚Ñ€Ð¾ÐºÐ¸: H2 â€” ÐºÑ€Ð°ÑÐ½Ð°Ñ (404), H3/H4 â€” Ð¶Ñ‘Ð»Ñ‚Ð°Ñ (403 Ð¸ 503)
 * - Ð¡Ñ‡Ð¸Ñ‚Ð°ÐµÑ‚ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¹ Ð¿Ð¾ ÑÐ°Ð¹Ñ‚Ð°Ð¼ Ð¸ Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð² ÐºÐ¾Ð»Ð¾Ð½ÐºÑƒ J
 * 
 * Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð²ÐµÑ€ÑÐ¸Ð¹:
 * v1.0 â€“ 24.03.2025 â€“ Ð±Ð°Ð·Ð¾Ð²Ð°Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑÑ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ¸ (Ð²ÑÐµÐ³Ð¾, 404, 403, Ð´Ð°Ñ‚Ð°)
 * v1.1 â€“ 24.03.2025 â€“ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð¿Ð¾Ð´ÑÑ‡Ñ‘Ñ‚ 503, Ñ€Ð°ÑÐºÑ€Ð°ÑÐºÐ° ÑÑ‡ÐµÐµÐº H2â€“H4
 * v1.2 â€“ 24.03.2025 â€“ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð¿Ð¾Ð´ÑÑ‡Ñ‘Ñ‚ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¹ Ð¿Ð¾ ÑÐ°Ð¹Ñ‚Ð°Ð¼ VC, Habr, ÐŸÐ¸ÐºÐ°Ð±Ñƒ, DTF, tproger, Spark (ÐºÐ¾Ð»Ð¾Ð½ÐºÐ° J)
 */

function updateStatsPanel() {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName("404 (Ð½Ðµ Ð¼ÐµÐ½ÑÑ‚ÑŒ!)");
  const codes = sheet.getRange("D7:D").getValues().flat().filter(Boolean);

  const total = codes.length;
  const count404 = codes.filter(c => String(c) === "404").length;
  const count403 = codes.filter(c => String(c) === "403").length;
  const count503 = codes.filter(c => String(c) === "503").length;
  const lastDate = sheet.getRange("E7:E").getValues().flat().filter(Boolean).pop();

  sheet.getRange("H1").setValue(`Ð’ÑÐµÐ³Ð¾ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²: ${total}`).setBackground(null);
  sheet.getRange("H2").setValue(`404 Ð¾ÑˆÐ¸Ð±Ð¾Ðº: ${count404}`).setBackground("#f4cccc");
  sheet.getRange("H3").setValue(`403 Ð¾ÑˆÐ¸Ð±Ð¾Ðº: ${count403}`).setBackground("#fff2cc");
  sheet.getRange("H4").setValue(`503 Ð¾ÑˆÐ¸Ð±Ð¾Ðº: ${count503}`).setBackground("#fff2cc");
  sheet.getRange("H5").setValue(`ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°: ${lastDate || "-"}`).setBackground(null);

  // === ÐŸÐ¾Ð´ÑÑ‡Ñ‘Ñ‚ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¹ Ð¿Ð¾ ÑÐ°Ð¹Ñ‚Ð°Ð¼ ===
  const urls = sheet.getRange("B7:B").getValues().flat().filter(Boolean);
  const counters = {
    "VC": urls.filter(u => u.includes("vc.ru")).length,
    "Habr": urls.filter(u => u.includes("habr.com")).length,
    "ÐŸÐ¸ÐºÐ°Ð±Ñƒ": urls.filter(u => u.includes("pikabu.ru")).length,
    "DTF": urls.filter(u => u.includes("dtf.ru")).length,
    "tproger": urls.filter(u => u.includes("tproger.ru")).length,
    "Spark": urls.filter(u => u.includes("spark-interfax.ru")).length
  };

  const sites = ["VC", "Habr", "ÐŸÐ¸ÐºÐ°Ð±Ñƒ", "DTF", "tproger", "Spark"];
  sites.forEach((name, i) => {
    sheet.getRange(1 + i, 10).setValue(`${name}: ${counters[name] || 0}`);
  });
}
