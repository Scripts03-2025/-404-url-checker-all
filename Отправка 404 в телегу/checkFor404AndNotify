const TELEGRAM_TOKEN = '8136586676:AAHvXeM4ih9ECPdSwzGM5P0O1p2_GYb_iTk';
const TELEGRAM_CHAT_ID = '8003377702';

function checkFor404AndNotify() {
  const sheet = SpreadsheetApp.getActive().getSheetByName('404 (–Ω–µ –º–µ–Ω—è—Ç—å!)');
  const data = sheet.getDataRange().getValues();

  for (let i = 1; i < data.length; i++) {
    const status = data[i][3]; // –°—Ç–æ–ª–±–µ—Ü D

    if (status === 404) {
      const textId = data[i][0];   // –°—Ç–æ–ª–±–µ—Ü A
      const badLink = data[i][1];  // –°—Ç–æ–ª–±–µ—Ü B
      const author = data[i][5];   // –°—Ç–æ–ª–±–µ—Ü F

      const message = `
üö® –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –æ—à–∏–±–∫–∞ 404

üÜî ID —Ç–µ–∫—Å—Ç–∞: ${textId}  
üîó –ë–∏—Ç–∞—è —Å—Å—ã–ª–∫–∞: ${badLink}  
üë§ –†–∞–∑–º–µ—Å—Ç–∏–ª: ${author}
      `.trim();

      sendTelegramMessage(message);
    }
  }
}

function sendTelegramMessage(message) {
  const url = `https://api.telegram.org/bot${TELEGRAM_TOKEN}/sendMessage`;
  const payload = {
    chat_id: TELEGRAM_CHAT_ID,
    text: message,
    parse_mode: 'Markdown'
  };

  const options = {
    method: 'post',
    contentType: 'application/json',
    payload: JSON.stringify(payload)
  };

  UrlFetchApp.fetch(url, options);
}
